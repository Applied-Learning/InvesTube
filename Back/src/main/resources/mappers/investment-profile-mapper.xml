<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.Investube.mvc.model.dao.InvestmentProfileDao">

    <!-- 사용자의 투자 성향 프로필 목록 조회 -->
    <select id="getProfilesByUserId" resultType="InvestmentProfile">
        SELECT * FROM investment_profiles
        WHERE user_id = #{userId}
        ORDER BY is_default DESC, created_at DESC
    </select>

    <!-- 사용자의 기본 투자 성향 프로필 조회 -->
    <select id="getDefaultProfile" resultType="InvestmentProfile">
        SELECT * FROM investment_profiles
        WHERE user_id = #{userId} AND is_default = TRUE
        LIMIT 1
    </select>

    <!-- 투자 성향 프로필 조회 (ID) -->
    <select id="getProfileById" resultType="InvestmentProfile">
        SELECT * FROM investment_profiles
        WHERE profile_id = #{profileId}
    </select>

    <!-- 투자 성향 프로필 생성 -->
    <insert id="insertProfile" parameterType="InvestmentProfile" useGeneratedKeys="true" keyProperty="profileId">
        INSERT INTO investment_profiles (
            user_id, profile_name,
            weight_revenue_growth, weight_operating_margin, weight_roe,
            weight_debt_ratio, weight_fcf, weight_per, weight_pbr,
            is_default
        ) VALUES (
            #{userId}, #{profileName},
            #{weightRevenueGrowth}, #{weightOperatingMargin}, #{weightRoe},
            #{weightDebtRatio}, #{weightFcf}, #{weightPer}, #{weightPbr},
            #{isDefault}
        )
    </insert>

    <!-- 투자 성향 프로필 업데이트 -->
    <update id="updateProfile" parameterType="InvestmentProfile">
        UPDATE investment_profiles SET
            profile_name = #{profileName},
            weight_revenue_growth = #{weightRevenueGrowth},
            weight_operating_margin = #{weightOperatingMargin},
            weight_roe = #{weightRoe},
            weight_debt_ratio = #{weightDebtRatio},
            weight_fcf = #{weightFcf},
            weight_per = #{weightPer},
            weight_pbr = #{weightPbr},
            is_default = #{isDefault}
        WHERE profile_id = #{profileId}
    </update>

    <!-- 기본 프로필 해제 (다른 프로필을 기본으로 설정하기 전에) -->
    <update id="clearDefaultProfile">
        UPDATE investment_profiles SET is_default = FALSE
        WHERE user_id = #{userId} AND is_default = TRUE
    </update>

    <!-- 투자 성향 프로필 삭제 -->
    <delete id="deleteProfile">
        DELETE FROM investment_profiles
        WHERE profile_id = #{profileId}
    </delete>

</mapper>
